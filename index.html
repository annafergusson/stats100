<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Anna Fergusson (Department of Statistics, University of Auckland)" />


<title>STATS 100 Investigations</title>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="section-header">



<h1 class="title toc-ignore">STATS 100 Investigations</h1>
<h4 class="author">Anna Fergusson (Department of Statistics, University of Auckland)</h4>

</div>


<p><link href="https://fonts.googleapis.com/css?family=Inconsolata|Londrina+Solid&display=swap" rel="stylesheet"></p>
<style type="text/css">
h1, h3{
  font-family: 'Londrina Solid', cursive;
}

h3 {
  color: #f5af86;
}

body{
  font-family: 'Inconsolata', monospace;
}

a {
  color: #000000;
  font-weight: bold;
  text-decoration: underline;
}
</style>
<div id="section-section" class="section level1 tabset">
<h1></h1>
<div id="section-introduction" class="section level2">
<h2>Introduction</h2>
<p><img src="images/STATS100-Cover-Logo.png" style="width:300px" /></p>
<p>These investigations have been developed for STATS 100 Concepts in Statistics, an introductory statistics and data science course offered by the <a href="https://www.auckland.ac.nz/en/science/about-the-faculty/department-of-statistics.html">Department of Statistics, University of Auckland</a>.</p>
<p>For more information, contact <a href="https://www.stat.auckland.ac.nz/people/amar112">Anna Fergusson</a>.</p>
</div>
<div id="section-a-google-eats" class="section level2">
<h2>1A Google eats?</h2>
<p><div class="form-group shiny-input-container">
<label for="search_term">Google search term</label>
<input id="search_term" type="text" class="form-control" value="tomato"/>
</div><div class="form-group shiny-input-container">
<label class="control-label" for="food_name">Food item</label>
<div>
<select id="food_name"><option value="default" selected>default</option></select>
<script type="application/json" data-for="food_name" data-nonempty="">{}</script>
</div>
</div><button id="update_data" type="button" class="btn btn-default action-button">Update plots</button></p>
<div id="time_plot" class="shiny-plot-output" style="width: 100% ; height: 400px"></div>
<div id="corr_plot" class="shiny-plot-output" style="width: 100% ; height: 400px"></div> 
<script type="application/shiny-prerendered" data-context="server-start">
library(shiny)
library(tidyverse)
library(lubridate)
library(glue)
library(gtrendsR)
library(stringr)
library(ggthemr)
ggthemr("fresh")
library(patchwork)

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
</script>
 
<script type="application/shiny-prerendered" data-context="data">
file_name <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQncFJgi1nqIMdn5zcaCxqv8QjQuAEmSWbzSXC80bkp6PwKoUDStY4rsYGao-MqC5Qgrsk9S4hWSsA_/pub?gid=0&single=true&output=csv"

df_food_prices <- read_csv(file_name) %>%
  mutate(date = ymd(glue("{Period}.1"))) %>%
  rename(value = Data_value, food = Series_title_1) %>%
  select(date, value, food) %>%
  mutate(date = floor_date(date, unit = "1 months" )) %>%
  group_by(date, food) %>%
  summarise(value = mean(value))

food_items <- df_food_prices %>%
  pull(food) %>%
  unique()
</script>
 
<script type="application/shiny-prerendered" data-context="server">
values <- reactiveValues(df_data = NULL,
                         min_date = NULL,
                         chart_title = NULL, 
                         chart_subtitle = NULL, 
                         chart_sources = NULL)

observeEvent(input$update_data, {
   showModal(modalDialog("Updating plots", footer=NULL))
    google_search_term <- input$search_term
    
    trend_data <- gtrends(keyword = c(google_search_term),
                          time = "all",
                          geo = c("NZ"))
    
    if (!is.null(trend_data$interest_over_time))
    {
    poss_food <- df_food_prices %>%
      filter(str_detect(str_to_lower(food), str_to_lower(google_search_term))) %>%
      pull(food) %>%
      unique()
    
    # check input box?
    nz_food_item <- input$food_name
    if (input$food_name == "default")
    {
      nz_food_item <- poss_food[1]
    }
    
    # check if food item selected is on poss_food
    if(!input$food_name %in% poss_food)
    {
      nz_food_item <- poss_food[1]
    }
  
    updateSelectInput(
      session,
      "food_name",
      choices = poss_food,
      selected = nz_food_item
    )
    
    # only select that food
    df_specific_food <- df_food_prices %>%
      filter(food == nz_food_item) %>%
      mutate(series = "mean_food_price")

    
  search_data <- trend_data$interest_over_time 
  missing_dates <- seq(ymd("2004-01-01"),
                       floor_date(Sys.Date(),
                                  "month"), 
                       by="months")

  if(length(missing_dates) > nrow(search_data))
  {
    missing_dates <- head(missing_dates, 
                          -(length(missing_dates) - nrow(search_data)))
  }

  search_data$date <- missing_dates
  
  gt_index <- search_data %>%
    select(date, hits) %>%
    rename(value = hits) %>%
    mutate(series = "google_search_interest")
  
  #min_date <- min(gt_index$date)
  min_date <- ymd("2015-01-01")
  
  combined_data <- bind_rows(gt_index, df_specific_food)
  food_data <- df_specific_food %>%
    filter(date >= min_date)
  
  combined_data$series <- factor(combined_data$series, 
                                 levels = c("mean_food_price",
                                            "google_search_interest"))
      
    values$min_date <- min_date
    values$df_data <- combined_data
    values$chart_title <- glue::glue("The mean price of '{nz_food_item}' in NZ \ncompared to Google search interest for '{google_search_term}' in NZ")
    values$chart_subtitle <- ""
    values$chart_sources <- "Data sources: StatsNZ and Google trends via {gtrendsR}"
    }
    removeModal()
  })

output$time_plot <- renderPlot({
  if (is.null(values$df_data)) return()
  values$df_data %>%
    filter(date >= values$min_date) %>%
    ggplot(aes(x = date, 
                  y = value, 
                  group = series, 
                  color = series)) +
    geom_point() +
    geom_line() +
    facet_wrap(~series, scale = "free_y", ncol = 1) +
    scale_x_date(date_breaks = "3 months",
                 date_labels = "%b\n%Y") +
    guides(color = FALSE)  +
    labs(title = values$chart_title,
         subtitle = values$chart_subtitle,
         caption = values$chart_sources,
         x = "Month")
})

output$corr_plot <- renderPlot({
  if (is.null(values$df_data)) return()
  values$df_data %>%
    select(date, series, value) %>%
    spread(series, value) %>%
    filter(date >= values$min_date,
           !is.na(mean_food_price)) -> combined_data_re
  
  search_correlation <- cor(combined_data_re$google_search_interest, 
      combined_data_re$mean_food_price, method = "spearman")
  
   p <- combined_data_re %>%
    ggplot() +
    geom_point(aes(google_search_interest, mean_food_price))  +
    scale_x_continuous(breaks = seq(0, 100, 10)) +
    annotate(geom = "label", 
             label = glue("Rank correlation coefficent: {round(search_correlation, 2)}"), 
             colour = "#666666",
             x = Inf, 
             y = Inf,
             vjust = 1,
             hjust = 1)  +
    labs(title = values$chart_title,
         subtitle = values$chart_subtitle,
         caption = values$chart_sources) 
  p + plot_spacer()
})
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.13"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.11.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["href"]}},"value":[{"type":"character","attributes":{},"value":["shared/selectize"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"character","attributes":{},"value":["<!--[if lt IE 9]>\n<script src=\"shared/selectize/js/es5-shim.min.js\"><\/script>\n<![endif]-->\n<script src=\"shared/selectize/js/selectize.min.js\"><\/script>"]},{"type":"NULL"},{"type":"NULL"},{"type":"logical","attributes":{},"value":[true]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71]},"class":{"type":"character","attributes":{},"value":["data.frame"]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","broom","cellranger","cli","colorspace","compiler","crayon","curl","datasets","digest","dplyr","evaluate","forcats","generics","ggplot2","ggthemr","glue","graphics","grDevices","grid","gtable","gtrendsR","haven","hms","htmltools","httpuv","httr","jsonlite","knitr","later","lattice","lazyeval","lubridate","magrittr","methods","mime","modelr","munsell","nlme","patchwork","pillar","pkgconfig","plyr","promises","purrr","R6","Rcpp","readr","readxl","rlang","rmarkdown","rstudioapi","rvest","scales","shiny","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","tools","utils","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","1.1.4","3.4.3","0.5.2","1.1.0","1.1.0","1.4-1","3.4.3","1.3.4","4.1","3.4.3","0.6.20","0.8.0.1","0.14","0.4.0","0.0.2","3.1.1","1.1.0","1.3.1","3.4.3","3.4.3","3.4.3","0.3.0","1.4.3","2.1.0","0.4.2","0.3.6","1.5.1","1.4.0","1.6","1.23","0.8.0","0.20-35","0.2.2","1.7.4","1.5","3.4.3","0.6","0.1.4","0.5.0","3.1-131","0.0.1","1.4.2","2.0.2","1.8.4","1.0.1","0.3.2","2.4.0","1.0.1","1.3.1","1.3.1","0.4.1","1.13","0.10","0.3.3","1.0.0","1.3.2","3.4.3","1.4.3","1.4.0","2.1.1","0.8.3","0.2.5","1.2.1","3.4.3","3.4.3","2.1.2.9000","0.8","1.2.0","1.8-4","2.2.0"]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
